---
export interface Props {
  type: 'website' | 'article' | 'person' | 'service';
  lang?: 'de' | 'tr';
  pageTitle?: string;
  pageDescription?: string;
  pageUrl?: string;
  articlePublishDate?: string;
  serviceName?: string;
  serviceDescription?: string;
  servicePrice?: string;
}

const { 
  type, 
  lang = 'de', 
  pageTitle, 
  pageDescription, 
  pageUrl,
  articlePublishDate,
  serviceName,
  serviceDescription,
  servicePrice
} = Astro.props;

const baseUrl = (Astro.site?.href || 'https://elternherz.de').replace(/\/$/, '');

// LocalBusiness schema for the main organization
const localBusiness = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${baseUrl}#localbusiness`,
  "name": lang === 'de' ? "Elternherz - Elternbegleiterin" : "Elternherz - Ebeveyn Danışmanı",
  "description": lang === 'de' 
    ? "Professionelle Elternbegleitung und Beratung für Familien in deutscher und türkischer Sprache"
    : "Almanca ve Türkçe olarak aileler için profesyonel ebeveyn danışmanlığı ve rehberlik",
  "url": baseUrl,
  "priceRange": "€€",
  "availableLanguage": [
    {
      "@type": "Language",
      "name": "German",
      "alternateName": "de"
    },
    {
      "@type": "Language",
      "name": "Turkish",
      "alternateName": "tr"
    }
  ],
  "address": {
    "@type": "PostalAddress",
    "addressCountry": "DE"
  },
  "areaServed": {
    "@type": "Country",
    "name": "Germany"
  }
};

// Person schema for the consultant
const person = {
  "@context": "https://schema.org",
  "@type": "Person",
  "@id": `${baseUrl}#person`,
  "name": "Elternherz Consultant",
  "jobTitle": lang === 'de' ? "Elternbegleiterin" : "Ebeveyn Danışmanı",
  "description": lang === 'de'
    ? "Qualifizierte Elternbegleiterin mit Expertise in bilingualem Familiencoaching"
    : "İki dilli aile koçluğunda uzmanlığa sahip kalifiye ebeveyn danışmanı",
  "knowsLanguage": ["de", "tr"],
  "worksFor": {
    "@id": `${baseUrl}#localbusiness`
  }
};

// Organization schema
const organization = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": `${baseUrl}#organization`,
  "name": "Elternherz",
  "url": baseUrl,
  "logo": `${baseUrl}/assets/logo.webp`,
  "image": `${baseUrl}/assets/logo.webp`,
  "sameAs": [],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "availableLanguage": ["German", "Turkish"]
  }
};

// Service schema
const serviceSchema = serviceName ? {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": serviceName,
  "description": serviceDescription,
  "provider": {
    "@id": `${baseUrl}#localbusiness`
  },
  "areaServed": {
    "@type": "Country",
    "name": "Germany"
  },
  "availableLanguage": ["de", "tr"],
  ...(servicePrice && { "offers": {
    "@type": "Offer",
    "price": servicePrice,
    "priceCurrency": "EUR"
  }})
} : null;

// BreadcrumbList for navigation
const breadcrumb = pageUrl ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": lang === 'de' ? "Startseite" : "Ana Sayfa",
      "item": baseUrl
    },
    // Only add second item if not on homepage
    ...(pageUrl.replace(/\/$/, '') !== baseUrl.replace(/\/$/, '') ? [{
      "@type": "ListItem",
      "position": 2,
      "name": pageTitle || "",
      "item": pageUrl
    }] : [])
  ]
} : null;

// WebSite schema
const website = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": `${baseUrl}#website`,
  "url": baseUrl,
  "name": "Elternherz",
  "inLanguage": [lang]
};

// Article schema for blog posts
const article = type === 'article' && pageTitle ? {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": pageTitle,
  "description": pageDescription,
  "url": pageUrl,
  "datePublished": articlePublishDate,
  "author": {
    "@id": `${baseUrl}#person`
  },
  "publisher": {
    "@id": `${baseUrl}#organization`
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": pageUrl
  },
  "inLanguage": lang
} : null;

// Construct the schema array based on page type
const schemas = [];

if (type === 'website') {
  schemas.push(localBusiness, organization, person, website);
} else if (type === 'article') {
  schemas.push(organization, person, article);
} else if (type === 'service') {
  schemas.push(localBusiness, organization, person, serviceSchema);
}

if (breadcrumb && breadcrumb.itemListElement.length > 1) {
  schemas.push(breadcrumb);
}

// Remove null values
const finalSchemas = schemas.filter(Boolean);
---

{finalSchemas.map((schema) => (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
))}
